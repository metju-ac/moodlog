import{d as Me,f as $,a as g,s as F,c as ue,t as Ce}from"../chunks/BSd0SMRY.js";import{s as N,h as le,i as Te,g as e,b as m,j as P,p as ze,a as Le,e as f,d as l,t as ee,c as Ee,m as Ae,$ as Pe,r as c,u as h,k as G,n as Be}from"../chunks/CDxfNvir.js";import{e as Ie,s as B}from"../chunks/BDbKEsgj.js";import{i as Ne}from"../chunks/DkEcSCtK.js";import{c as y}from"../chunks/-xzLaWd6.js";import{h as Re}from"../chunks/bikO0i6L.js";import{C as Fe,a as Ge,b as He,c as Ye,S as je,A as ce,d as Ke,e as Oe,T as We,f as qe,l as Je,t as Qe}from"../chunks/DAWhQf4p.js";import{g as Ue}from"../chunks/qHyC3OlR.js";import{S as I,m as Ve}from"../chunks/BkllnMPr.js";import{S as Xe}from"../chunks/CmE-KL-b.js";import{N as Ze,l as et}from"../chunks/DpjhzJZR.js";class fe extends Map{#e=new Map;#t=N(0);#r=N(0);#o=le||-1;constructor(r){if(super(),r){for(var[t,a]of r)super.set(t,a);this.#r.v=super.size}}#s(r){return le===this.#o?N(r):Te(r)}has(r){var t=this.#e,a=t.get(r);if(a===void 0){var d=super.get(r);if(d!==void 0)a=this.#s(0),t.set(r,a);else return e(this.#t),!1}return e(a),!0}forEach(r,t){this.#a(),super.forEach(r,t)}get(r){var t=this.#e,a=t.get(r);if(a===void 0){var d=super.get(r);if(d!==void 0)a=this.#s(0),t.set(r,a);else{e(this.#t);return}}return e(a),super.get(r)}set(r,t){var a=this.#e,d=a.get(r),S=super.get(r),k=super.set(r,t),_=this.#t;if(d===void 0)d=this.#s(0),a.set(r,d),m(this.#r,super.size),P(_);else if(S!==t){P(d);var R=_.reactions===null?null:new Set(_.reactions),D=R===null||!d.reactions?.every(M=>R.has(M));D&&P(_)}return k}delete(r){var t=this.#e,a=t.get(r),d=super.delete(r);return a!==void 0&&(t.delete(r),m(this.#r,super.size),m(a,-1),P(this.#t)),d}clear(){if(super.size!==0){super.clear();var r=this.#e;m(this.#r,0);for(var t of r.values())m(t,-1);P(this.#t),r.clear()}}#a(){e(this.#t);var r=this.#e;if(this.#r.v!==r.size){for(var t of super.keys())if(!r.has(t)){var a=this.#s(0);r.set(t,a)}}for([,a]of this.#e)e(a)}keys(){return e(this.#t),super.keys()}values(){return this.#a(),super.values()}entries(){return this.#a(),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return e(this.#r),super.size}}var tt=$('<button type="button"><!> <span> </span></button>'),rt=$('<div class="rounded-lg border border-border/50 bg-background px-3 py-2 text-xs shadow-xl"><div class="font-medium"> </div> <div class="mt-1 flex items-center gap-2"><div class="h-2 w-2 rounded-full bg-[#485e92]"></div> <span class="text-muted-foreground"> </span></div> <div class="mt-0.5 text-[10px] text-muted-foreground"> </div></div>'),st=$("<!> <!> <!> <!>",1),at=$('<div class="h-[300px] w-full"><!></div>'),ot=$('<div class="flex h-[300px] w-full items-center justify-center text-sm text-muted-foreground">No mood entries found for the selected criteria</div>'),nt=$("<!> <!>",1),it=$('<div class="flex h-screen flex-col bg-white"><main class="flex flex-1 flex-col gap-6 overflow-y-auto px-4 py-4"><div class="flex flex-wrap gap-2 py-2"><button type="button">Week</button> <button type="button">Month</button> <button type="button">3 Months</button> <button type="button">Year</button></div> <div class="flex flex-wrap gap-2"></div> <!></main> <!></div>');function $t(te,r){ze(r,!0);let t=N("3months"),a=N(Le(new Set));const d=h(()=>{const n=new Date,o=new I(n);o.setHours(23,59,59,999);const s=new I(n);switch(e(t)){case"week":s.setDate(n.getDate()-7);break;case"month":s.setMonth(n.getMonth()-1);break;case"3months":s.setMonth(n.getMonth()-3);break;case"year":s.setFullYear(n.getFullYear()-1);break}return s.setHours(0,0,0,0),{start:s,end:o}}),S=h(()=>Ve.allEntries.filter(n=>n.date>=e(d).start&&n.date<=e(d).end?e(a).size===0?!0:n.labels.some(s=>e(a).has(s.id)):!1)),k=h(()=>{if(e(S).length===0)return[];if(e(t)==="week"||e(t)==="month"){const o=new fe;return e(S).forEach(s=>{const i=s.date.toISOString().split("T")[0];o.has(i)||o.set(i,[]),o.get(i).push(s)}),Array.from(o.entries()).map(([s,i])=>{const u=i.reduce((p,x)=>p+x.moodLevel,0)/i.length;return{date:new Date(s+"T12:00:00"),averageMood:u,entryCount:i.length}}).sort((s,i)=>s.date.getTime()-i.date.getTime())}else{const o=new fe;return e(S).forEach(s=>{const i=new I(s.date);i.setDate(s.date.getDate()-s.date.getDay()),i.setHours(0,0,0,0);const u=i.toISOString().split("T")[0];o.has(u)||o.set(u,[]),o.get(u).push(s)}),Array.from(o.entries()).map(([s,i])=>{const u=i.reduce((p,x)=>p+x.moodLevel,0)/i.length;return{date:new Date(s+"T12:00:00"),averageMood:u,entryCount:i.length}}).sort((s,i)=>s.date.getTime()-i.date.getTime())}}),_=h(()=>e(k).length===0?[e(d).start,e(d).end]:[e(d).start,e(d).end]);function R(n){const o=new Xe(e(a));o.has(n)?o.delete(n):o.add(n),m(a,o,!0)}var D=it();Re("u6zn5i",n=>{Ae(()=>{Pe.title="Insights - MoodLog"})});var M=f(D),H=f(M),Y=f(H);Y.__click=()=>m(t,"week");var j=l(Y,2);j.__click=()=>m(t,"month");var K=l(j,2);K.__click=()=>m(t,"3months");var re=l(K,2);re.__click=()=>m(t,"year"),c(H);var O=l(H,2);Ie(O,21,()=>et.all,n=>n.id,(n,o)=>{const s=h(()=>Ue(e(o).icon)),i=h(()=>e(a).has(e(o).id));var u=tt();u.__click=()=>R(e(o).id);var p=f(u);y(p,()=>e(s),(T,z)=>{z(T,{class:"h-4 w-4",strokeWidth:2})});var x=l(p,2),C=f(x,!0);c(x),c(u),ee(()=>{B(u,1,`flex items-center gap-2 rounded-lg border border-[#c5c6d0] px-3 py-1.5 text-sm font-medium transition-colors ${e(i)?"bg-[#d9dff6] text-[#404659]":"bg-white text-[#44464f] hover:bg-gray-50"}`),F(C,e(o).name)}),g(n,u)}),c(O);var ve=l(O,2);y(ve,()=>qe,(n,o)=>{o(n,{class:"w-full",children:(s,i)=>{var u=nt(),p=G(u);y(p,()=>Fe,(C,T)=>{T(C,{children:(z,he)=>{var L=ue(),W=G(L);y(W,()=>Ge,(q,J)=>{J(q,{class:"text-2xl",children:(b,w)=>{Be();var Q=Ce("Average Mood");g(b,Q)},$$slots:{default:!0}})}),g(z,L)},$$slots:{default:!0}})});var x=l(p,2);y(x,()=>He,(C,T)=>{T(C,{children:(z,he)=>{var L=ue(),W=G(L);{var q=b=>{var w=at(),Q=f(w);{let me=h(Qe),pe=h(()=>[new I(e(_)[0]),new I(e(_)[1])]),xe=h(Je);Ye(Q,{get data(){return e(k)},x:"date",get xScale(){return e(me)},get xDomain(){return e(pe)},y:"averageMood",get yScale(){return e(xe)},yDomain:[-10,10],padding:{top:16,bottom:32,left:48,right:16},children:(be,dt)=>{je(be,{children:(_e,ut)=>{var se=st(),ae=G(se);ce(ae,{placement:"left",grid:!0,rule:!1,ticks:[-10,-5,0,5,10],format:E=>{const v=Math.round(E);return v>0?`+${v}`:String(v)},class:"text-xs text-muted-foreground"});var oe=l(ae,2);{let E=h(()=>e(t)==="week"?7:6);ce(oe,{placement:"bottom",rule:!1,get ticks(){return e(E)},format:v=>e(t)==="week"||e(t)==="month"?v.toLocaleDateString("en-GB",{month:"short",day:"numeric"}):v.toLocaleDateString("en-GB",{month:"short",day:"numeric"}),class:"text-xs text-muted-foreground"})}var ne=l(oe,2);Ke(ne,{get curve(){return Oe},class:"fill-none stroke-[#485e92] stroke-2"});var $e=l(ne,2);{const E=(v,U)=>{let A=()=>U?.().data;var V=rt(),X=f(V),we=f(X,!0);c(X);var Z=l(X,2),ie=l(f(Z),2),ye=f(ie);c(ie),c(Z);var de=l(Z,2),Se=f(de);c(de),c(V),ee((ke,De)=>{F(we,ke),F(ye,`Avg Mood: ${A().averageMood>0?"+":""}${De??""}`),F(Se,`${A().entryCount??""}
                        ${A().entryCount===1?"entry":"entries"}`)},[()=>A().date.toLocaleDateString("en-GB",{month:"short",day:"numeric",year:"numeric"}),()=>A().averageMood.toFixed(1)]),g(v,V)};y($e,()=>We,(v,U)=>{U(v,{variant:"none",children:E,$$slots:{default:!0}})})}g(_e,se)},$$slots:{default:!0}})},$$slots:{default:!0}})}c(w),g(b,w)},J=b=>{var w=ot();g(b,w)};Ne(W,b=>{e(k).length>0?b(q):b(J,!1)})}g(z,L)},$$slots:{default:!0}})}),g(s,u)},$$slots:{default:!0}})}),c(M);var ge=l(M,2);Ze(ge,{currentTab:"insights"}),c(D),ee(()=>{B(Y,1,`rounded-lg border border-[#c5c6d0] px-3 py-1.5 text-sm font-medium transition-colors ${e(t)==="week"?"bg-[#d9dff6] text-[#404659]":"bg-white text-[#44464f] hover:bg-gray-50"}`),B(j,1,`rounded-lg border border-[#c5c6d0] px-3 py-1.5 text-sm font-medium transition-colors ${e(t)==="month"?"bg-[#d9dff6] text-[#404659]":"bg-white text-[#44464f] hover:bg-gray-50"}`),B(K,1,`rounded-lg border border-[#c5c6d0] px-3 py-1.5 text-sm font-medium transition-colors ${e(t)==="3months"?"bg-[#d9dff6] text-[#404659]":"bg-white text-[#44464f] hover:bg-gray-50"}`),B(re,1,`rounded-lg border border-[#c5c6d0] px-3 py-1.5 text-sm font-medium transition-colors ${e(t)==="year"?"bg-[#d9dff6] text-[#404659]":"bg-white text-[#44464f] hover:bg-gray-50"}`)}),g(te,D),Ee()}Me(["click"]);export{$t as component};
